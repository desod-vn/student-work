<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - StudentWork</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/deo.css" />
    <link rel="stylesheet" href="~/assets/fontawesome-5.15.1/css/all.min.css" />
    <script src="~/assets/fontawesome-5.15.1/js/all.js"></script>
</head>
<body>
    <div class="d-container">
        <div class="d-menu">
            <div class="d-menu-wrap">
                <span>
                    <img src="~/assets/img/toggle.png" class="d-menu-icon" />
                </span>
                <a href="">
                    <img src="~/assets/img/logo.png" class="d-menu-logo" />
                </a>
            </div>

            <partial name="_MenuItem" />
        </div>
        <div class="d-content">
            <header class="d-header">
                <div class="d-header-name">
                    @ViewData["Title"]
                </div>
                @* <div class="d-header-user">
                    <img src="assets/icon/avatar-default.png" class="logo-user"/>
                    Vương Toàn Thắng
                    <img src="assets/icon/option.png" />
                </div> *@
            </header>

            <main class="d-content-data">
                @RenderBody()
            </div>
        </div>
    </div>


    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <script>
        function encodeImageFileAsURL(file, wrapper) {
            var reader = new FileReader();
            reader.onloadend = function () {
                @*console.log('RESULT', reader.result)*@
                $(wrapper).append(`
                    <div class="col-md-4">
                        <img src="${reader.result}" style="width: 100%; height: 200px; object-fit: contain; object-position: center;" />
                        <button class="btn"
                            onclick="onImageRemoved(event, '${wrapper}')"
                            style="
                            position: absolute;
                            right: 0;
                            top: 0;
                        ">x</button>
                    </div>

                `)
            }
            reader.readAsDataURL(file);
        }

        function FileListItems(files) {
            var b = new ClipboardEvent("").clipboardData || new DataTransfer()
            for (var i = 0, len = files.length; i < len; i++) b.items.add(files[i])
            return b.files
        }

        function onFileChosen(e, wrapper) {
            console.log(e)

            const files = e.target.files
            for (let file of files) {
                encodeImageFileAsURL(file, wrapper)
            }
        }

        function onImageRemoved(e, wrapper) {
            e.stopPropagation()
            e.preventDefault()

            console.log(e)
            let parent = $(e.target).parent()
            let fileInput = $(`${wrapper}`).parent().find('input[type=file]')[0]
            @*console.log(fileInput)*@
            parent.remove()

            let deleteIndex = $(`${wrapper} .col-md - 4`).index(parent[0]);
            let arr = [...fileInput.files]
            arr.splice(deleteIndex, 1)

            fileInput.files = new FileListItems(arr)
        }
    </script>
</body>
</html>
